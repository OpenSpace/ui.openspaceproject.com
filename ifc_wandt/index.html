<html>
  <head>
    <title>IFC - M. Wandt</title>
    <link rel="stylesheet" type="text/css" href="main.css">
    <script type="text/javascript" src="openspace-api.js"></script>
    <script type="text/javascript" src="actions.js"></script>
    <script type="text/javascript">
      //variable for js libarary
      var openspace = null;

      const delay = ms => new Promise(res => setTimeout(res, ms));

      function checkedFunc() {
        let cbox = document.getElementById("rot-override");

        if (cbox.checked) {
          document.getElementById("rotx").disabled = false;
          document.getElementById("roty").disabled = false;
          document.getElementById("rotz").disabled = false;
        } else {
          document.getElementById("rotx").disabled = true;
          document.getElementById("roty").disabled = true;
          document.getElementById("rotz").disabled = true;
        }
      } 

      //helper function to connect to opensapce
      var connectToOpenSpace = () => {
        //setup the api params
        var host = document.getElementById('ipaddress').value;
        var api = window.openspaceApi(host, 4682);
        //notify users on disconnect
        api.onDisconnect(() => {
          console.log("disconnected");
          document.getElementById('container').className = "disconnected";
          document.getElementById('connection-status').style.opacity = 1;
          var disconnectedString = "Connect to OpenSpace: ";
          disconnectedString += '<input id="ipaddress" type=text value="127.0.0.1" /> ';
          disconnectedString += '<button onClick="connectToOpenSpace();">Connect</button>';
          document.getElementById('connection-status').innerHTML = disconnectedString;
          openspace = null;
          document.getElementById("blocker").classList.add("blockit");
        });
        //notify users and map buttons when connected
        api.onConnect(async () => {
          try {
            document.getElementById('container').className = "connected";
            document.getElementById('connection-status').innerHTML = "";
            openspace = await api.library();
            console.log('connected');
            // mapButtons(openspace);
            document.getElementById("blocker").classList.remove("blockit");
          } catch (e) {
            console.log('OpenSpace library could not be loaded: Error: \n', e);
            return;
          }

          document.getElementById("rotx").value = DEFAULT_ISS_ROTATION[0];
          document.getElementById("roty").value = DEFAULT_ISS_ROTATION[1];
          document.getElementById("rotz").value = DEFAULT_ISS_ROTATION[2];
        })
        //connect
        api.connect();
      };

      function logMessage(message) {
        console.log(message);
        document.getElementById('connection-status').innerHTML = message;
        document.getElementById("connection-status").style.transition = "all 0s";
        document.getElementById("connection-status").style.opacity = 1;
        document.getElementById("connection-status").style.color = "#ff0000"
        document.getElementById("connection-status").style.fontSize = "16pt";
        fadeOut();
      }

      // function that fades out the log div after 5 seconds
      function fadeOut() {
        setTimeout(function() {
          var fade = document.getElementById("connection-status");
          var timerId = setInterval(function() {
            var opacity = fade.style.opacity;
            if (opacity == 0.0) {
              clearInterval(timerId);
              document.getElementById("connection-status").style.color = null;
              document.getElementById("connection-status").style.transition = null;
              document.getElementById("connection-status").style.fontWeight = null;
            } else {
              fade.style.opacity = opacity - 0.05;
            }
          }, 100);
        }, 5000);
      }
    </script>
  </head>
  <body>
    <!-- HTML Containers -->
    <div id="container" class="disconnected">
      <div id="connection-status" class="connection-status">
        Connect to OpenSpace:
        <input id='ipaddress' type=text placeholder="Enter ip address"/>
        <button onClick="connectToOpenSpace();">Connect</button>
      </div>
      <div id="main" style="display:flex; width:100%">
        <div id="blocker" class="blockit">
        </div>
        <div id="left" style="width: 60%">
          <div class='card'>
            <h2>Prepration step</h2>
            <label>Override: </label>
            <input type="checkbox" id="rot-override" onclick="checkedFunc()"/>
            <br>
            <label>ISS initial rotation: </label>
            <input type="number" id="rotx" min="-1" max="1" disabled>
            <input type="number" id="roty" min="-1" max="1" disabled>
            <input type="number" id="rotz" min="-1" max="1" disabled>
            <hr>
            <button type="button" onclick="prepare()">Pre-checks</button>
          </div>
          <div class="card">
            <h2>Camera views</h2>
            <label>Static Views</label>
            <br>
            <button type="button" class="defaultView" onclick="setViewDefault()">ISS (Default)</button>
            <br>
            <button type="button" class="staticViewCupola" onclick="setViewCupola1()">Cupola</button>
            <button type="button" class="staticViewCupola" onclick="setViewCupola2()">Cupola (left)</button>
            <br>
            <button type="button" class="staticViewIss" onclick="setViewIss1()">ISS (middle)</button>
            <button type="button" class="staticViewIss" onclick="setViewIss2()">ISS (top back)</button>
            <button type="button" class="staticViewIss" onclick="setViewIss5()">ISS (top front)</button>
            <button type="button" class="staticViewIss" onclick="setViewIss5b()">ISS(top front Alt.)</button>
            <hr>
            <label>Dynamic Views</label>
            <br>
            <button type="button" class="dynamicView" onclick="setViewIss3()">Default ISS (moving)</button>
            <button type="button" class="dynamicView" onclick="setViewIss4()">ISS (middle - moving)</button>
            <button type="button" class="dynamicView" onclick="setViewIss6()">ISS (top front - moving)</button>
            <button type="button" class="dynamicView" onclick="setViewIss7()">ISS (top front Alt. - moving)</button>
          </div>
        </div>
        <div id="right" style="flex-grow: 1;">
          <div class="card">
            <h2>Information</h3>
            <ul>
              <li>Run Prepare-button once when connected and once just before the show starts</li>
              <li>Do <u>NOT</u> pause OpenSpace during the show</li>
            </ul>
          </div>
        </div>
      </div>
      <script type="text/javascript">
        connectToOpenSpace('localhost');
      </script>
    </div>
  <body>
</html>
