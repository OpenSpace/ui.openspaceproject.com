<html>
  <style>
    body {
      background-image: url('../images/Earth.png');
      background-repeat: no-repeat;
      background-size: cover;
      background-position: center;
    }
  </style>
  <head>
    <title>OpenSpace Light Festival - Earth</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8"/>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../main_style.css">
    <script type="text/javascript" src="openspace-api.js"></script>
    <script type="text/javascript" src="openspace-statemachine.js"></script>
    <script type="text/javascript">
      // variable for js libarary
      var openspace = null;

      var htmlFunction = (action, id) => {
          var cardHTML = "<div class='card'>";
          if(action.title) {
            cardHTML += "<h2>" + action.title + "</h2>";
          }
          if (action.description) {
            action.description.split('\n').map(item => {
              cardHTML += "<p>" + item + "</p>";
            });
          }
          if (action.buttons) {
            Object.keys(action.buttons).map(button => {
              const fn = action.buttons[button];
              cardHTML += "<button id=\"" + action.title+button + "\">"+ button +"</button>";
            });
          }
          cardHTML += "</div>";
          document.getElementById('bottom-button-panel').innerHTML += cardHTML;
      };
      var clickFunction = (action, id) => {
        if (action.buttons) {
          Object.keys(action.buttons).map(button => {
              const fn = action.buttons[button];
              document.getElementById(action.title+button).addEventListener("click", fn);
          });
        }
      }

      // helper function to take user to new state
      function setupEarthState(openspace) {
        openspace.statemachine.goTo("Earth");
        earthButtonGroups.map(htmlFunction);
        earthButtonGroups.map(clickFunction);
      }
      
      // helper function to connect to opensapce
      var connectToOpenSpace = () => {
        // setup the api params
        var host = document.getElementById('ipaddress').value;
        var api = window.openspaceApi(host, 4682);
        // notify users on disconnect
        api.onDisconnect(() => {
          console.log("disconnected");
          document.getElementById('container').className = "disconnected";
          var disconnectedString = "Connect to OpenSpace: ";
          disconnectedString += '<input id="ipaddress" type=text placeholder="Enter ip address" /> ';
          disconnectedString += '<button onClick="connectToOpenSpace();">Connect</button>';
          document.getElementById('connection-status').innerHTML = disconnectedString;
          openspace = null;
        });
        // notify users and map buttons when connected
        api.onConnect(async () => {
          try {
            document.getElementById('container').className = "connected";
            document.getElementById('connection-status').innerHTML = "Connected to OpenSpace";
            openspace = await api.library();
            console.log('connected');
            setupEarthState(openspace);
          } catch (e) {
            console.log('OpenSpace library could not be loaded: Error: \n', e)
            return;
          }
        })
        // connect
        api.connect();
      };
    </script>
  </head>
  <body>
    <!-- HTML Containers -->
    <div id="container" class="disconnected">
      <div id="connection-status">
        Connect to OpenSpace:
        <input id='ipaddress' type=text placeholder="Enter ip address"/> 
        <button onClick="connectToOpenSpace();">Connect</button>
      </div>
      <div id="main">
        <div class='header'>
            <h1>Earth</h1>
        </div>
        <div class='card description'>
          <!-- TODO: Write content text and set up the buttong we want -->
          <p>
          Our home, Earth,  is the third planet from the Sun and the only astronomical object known 
          to harbor life. About 29% of Earth's surface is land consisting of continents 
          and islands. The remaining 71% is covered with water, mostly by oceans but 
          also lakes, rivers and other fresh water, which together constitute the 
          hydrosphere. Much of Earth's polar regions are covered in ice.
          Our home, Earth,  is the third planet from the Sun and the only astronomical object known 
          to harbor life. About 29% of Earth's surface is land consisting of continents 
          and islands. The remaining 71% is covered with water, mostly by oceans but 
          also lakes, rivers and other fresh water, which together constitute the 
          hydrosphere. Much of Earth's polar regions are covered in ice.
          Our home, Earth,  is the third planet from the Sun and the only astronomical object known 
          to harbor life. About 29% of Earth's surface is land consisting of continents 
          and islands. The remaining 71% is covered with water, mostly by oceans but 
          also lakes, rivers and other fresh water, which together constitute the 
          hydrosphere. Much of Earth's polar regions are covered in ice.
          </p>
        </div>
        <div id='bottom-button-panel'></div>
      </div>
      <script type="text/javascript">
        connectToOpenSpace('localhost');
      </script>
    </div>
    <div class="footer">
      <img id="logo" src="../images/openspace-horiz-logo.png" alt="OpenSpace logo">
    </div>
  <body>
</html>